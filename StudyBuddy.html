<!doctype html>
<html lang="th" class="h-full">
 <head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏ô‡∏ï‡∏¥‡∏ß‡∏Ñ‡∏π‡πà‡πÉ‡∏à</title>
  <script src="/_sdk/element_sdk.js"></script>
  <script src="https://cdn.tailwindcss.com"></script>
  <style>
    body {
      box-sizing: border-box;
    }
    
    .toast {
      position: fixed;
      top: 20px;
      right: 20px;
      background: #10b981;
      color: white;
      padding: 16px 24px;
      border-radius: 8px;
      box-shadow: 0 4px 6px rgba(0,0,0,0.1);
      z-index: 1000;
      animation: slideIn 0.3s ease-out;
    }
    
    .toast.error {
      background: #ef4444;
    }
    
    @keyframes slideIn {
      from {
        transform: translateX(400px);
        opacity: 0;
      }
      to {
        transform: translateX(0);
        opacity: 1;
      }
    }
    
    .lesson-card {
      transition: transform 0.2s, box-shadow 0.2s;
    }
    
    .lesson-card:hover {
      transform: translateY(-4px);
      box-shadow: 0 8px 16px rgba(0,0,0,0.1);
    }
    
    .post-card {
      border-left: 4px solid;
      transition: all 0.2s;
    }
    
    .post-card:hover {
      box-shadow: 0 4px 12px rgba(0,0,0,0.1);
    }
    
    .image-preview {
      position: relative;
      display: inline-block;
      margin: 8px;
    }
    
    .image-preview img {
      max-width: 150px;
      max-height: 150px;
      object-fit: cover;
      border-radius: 8px;
    }
    
    .image-remove {
      position: absolute;
      top: -8px;
      right: -8px;
      background: #ef4444;
      color: white;
      border-radius: 50%;
      width: 24px;
      height: 24px;
      display: flex;
      align-items: center;
      justify-content: center;
      cursor: pointer;
      font-size: 14px;
      font-weight: bold;
    }
  </style>
  <style>@view-transition { navigation: auto; }</style>
  <script src="/_sdk/data_sdk.js" type="text/javascript"></script>
 </head>
 <body class="h-full">
  <div id="app" class="w-full h-full"></div>
  <script>
    const defaultConfig = {
      site_title: "‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏ô‡∏ï‡∏¥‡∏ß‡∏Ñ‡∏π‡πà‡πÉ‡∏à",
      welcome_message: "‡∏¢‡∏¥‡∏ô‡∏î‡∏µ‡∏ï‡πâ‡∏≠‡∏ô‡∏£‡∏±‡∏ö‡∏™‡∏π‡πà‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏ô‡∏ï‡∏¥‡∏ß‡∏Ñ‡∏π‡πà‡πÉ‡∏à",
      primary_color: "#3b82f6",
      secondary_color: "#f3f4f6",
      text_color: "#1f2937",
      card_color: "#ffffff",
      accent_color: "#10b981",
      font_family: "Arial",
      font_size: 16
    };
    
    // Local Storage Functions
    function saveToLocalStorage(key, data) {
      try {
        localStorage.setItem(key, JSON.stringify(data));
      } catch (e) {
        console.error('Failed to save to localStorage', e);
      }
    }
    
    function loadFromLocalStorage(key, defaultValue = []) {
      try {
        const data = localStorage.getItem(key);
        return data ? JSON.parse(data) : defaultValue;
      } catch (e) {
        console.error('Failed to load from localStorage', e);
        return defaultValue;
      }
    }
    
    let appState = {
      currentView: 'login',
      currentUser: null,
      selectedGrade: null,
      selectedSubject: null,
      selectedLesson: null,
      editingPostId: null,
      imageUrls: []
    };
    
    let allPosts = loadFromLocalStorage('posts', []);
    let allUsers = loadFromLocalStorage('users', []);
    
    const gradeSubjects = {
      '‡∏°.1': ['‡∏ß‡∏¥‡∏ó‡∏¢‡∏≤‡∏®‡∏≤‡∏™‡∏ï‡∏£‡πå', '‡∏Ñ‡∏ì‡∏¥‡∏ï‡∏®‡∏≤‡∏™‡∏ï‡∏£‡πå', '‡∏†‡∏≤‡∏©‡∏≤‡πÑ‡∏ó‡∏¢', '‡∏†‡∏≤‡∏©‡∏≤‡∏≠‡∏±‡∏áÔøΩÔøΩ‡∏§‡∏©', '‡∏™‡∏±‡∏á‡∏Ñ‡∏°'],
      '‡∏°.2': ['‡∏ß‡∏¥‡∏ó‡∏¢‡∏≤‡∏®‡∏≤‡∏™‡∏ï‡∏£‡πå', '‡∏Ñ‡∏ì‡∏¥‡∏ï‡∏®‡∏≤‡∏™‡∏ï‡∏£‡πå', '‡∏†‡∏≤‡∏©‡∏≤‡πÑ‡∏ó‡∏¢', '‡∏†‡∏≤‡∏©‡∏≤‡∏≠‡∏±‡∏á‡∏Å‡∏§‡∏©', '‡∏™‡∏±‡∏á‡∏Ñ‡∏°'],
      '‡∏°.3': ['‡∏ß‡∏¥‡∏ó‡∏¢‡∏≤‡∏®‡∏≤‡∏™‡∏ï‡∏£‡πå', '‡∏Ñ‡∏ì‡∏¥‡∏ï‡∏®‡∏≤‡∏™‡∏ï‡∏£‡πå', '‡∏†‡∏≤‡∏©‡∏≤‡πÑ‡∏ó‡∏¢', '‡∏†‡∏≤‡∏©‡∏≤‡∏≠‡∏±‡∏á‡∏Å‡∏§‡∏©', '‡∏™‡∏±‡∏á‡∏Ñ‡∏°'],
      '‡∏°.4': ['‡∏ü‡∏¥‡∏™‡∏¥‡∏Å‡∏™‡πå', '‡πÄ‡∏Ñ‡∏°‡∏µ', '‡∏ä‡∏µ‡∏ß‡∏ß‡∏¥‡∏ó‡∏¢‡∏≤', '‡∏Ñ‡∏ì‡∏¥‡∏ï‡∏®‡∏≤‡∏™‡∏ï‡∏£‡πå', '‡∏†‡∏≤‡∏©‡∏≤‡πÑ‡∏ó‡∏¢', '‡∏†‡∏≤‡∏©‡∏≤‡∏≠‡∏±‡∏á‡∏Å‡∏§‡∏©', '‡∏™‡∏±‡∏á‡∏Ñ‡∏°'],
      '‡∏°.5': ['‡∏ü‡∏¥‡∏™‡∏¥‡∏Å‡∏™‡πå', '‡πÄ‡∏Ñ‡∏°‡∏µ', '‡∏ä‡∏µ‡∏ß‡∏ß‡∏¥‡∏ó‡∏¢‡∏≤', '‡∏Ñ‡∏ì‡∏¥‡∏ï‡∏®‡∏≤‡∏™‡∏ï‡∏£‡πå', '‡∏†‡∏≤‡∏©‡∏≤‡πÑ‡∏ó‡∏¢', '‡∏†‡∏≤‡∏©‡∏≤‡∏≠‡∏±‡∏á‡∏Å‡∏§‡∏©', '‡∏™‡∏±‡∏á‡∏Ñ‡∏°'],
      '‡∏°.6': ['‡∏ü‡∏¥‡∏™‡∏¥‡∏Å‡∏™‡πå', '‡πÄ‡∏Ñ‡∏°‡∏µ', '‡∏ä‡∏µ‡∏ß‡∏ß‡∏¥‡∏ó‡∏¢‡∏≤', '‡∏Ñ‡∏ì‡∏¥‡∏ï‡∏®‡∏≤‡∏™‡∏ï‡∏£‡πå', '‡∏†‡∏≤‡∏©‡∏≤‡πÑ‡∏ó‡∏¢', '‡∏†‡∏≤‡∏©‡∏≤‡∏≠‡∏±‡∏á‡∏Å‡∏§‡∏©', '‡∏™‡∏±‡∏á‡∏Ñ‡∏°']
    };
    
    const subjectLessons = {
      '‡∏ß‡∏¥‡∏ó‡∏¢‡∏≤‡∏®‡∏≤‡∏™‡∏ï‡∏£‡πå': ['‡∏ö‡∏ó‡∏ó‡∏µ‡πà 1: ‡∏ß‡∏¥‡∏ò‡∏µ‡∏Å‡∏≤‡∏£‡∏ó‡∏≤‡∏á‡∏ß‡∏¥‡∏ó‡∏¢‡∏≤‡∏®‡∏≤‡∏™‡∏ï‡∏£‡πå', '‡∏ö‡∏ó‡∏ó‡∏µ‡πà 2: ‡∏™‡∏™‡∏≤‡∏£‡πÅ‡∏•‡∏∞‡∏™‡∏°‡∏ö‡∏±‡∏ï‡∏¥', '‡∏ö‡∏ó‡∏ó‡∏µ‡πà 3: ‡∏Å‡∏≤‡∏£‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡πÅ‡∏õ‡∏•‡∏á‡∏Ç‡∏≠‡∏á‡∏™‡∏™‡∏≤‡∏£', '‡∏ö‡∏ó‡∏ó‡∏µ‡πà 4: ‡πÅ‡∏£‡∏á‡πÅ‡∏•‡∏∞‡∏Å‡∏≤‡∏£‡πÄ‡∏Ñ‡∏•‡∏∑‡πà‡∏≠‡∏ô‡∏ó‡∏µ‡πà', '‡∏ö‡∏ó‡∏ó‡∏µ‡πà 5: ‡∏û‡∏•‡∏±‡∏á‡∏á‡∏≤‡∏ô‡πÅ‡∏•‡∏∞‡∏Å‡∏≤‡∏£‡∏≠‡∏ô‡∏∏‡∏£‡∏±‡∏Å‡∏©‡πå'],
      '‡∏Ñ‡∏ì‡∏¥‡∏ï‡∏®‡∏≤‡∏™‡∏ï‡∏£‡πå': ['‡∏ö‡∏ó‡∏ó‡∏µ‡πà 1: ‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡πÄ‡∏ï‡πá‡∏°', '‡∏ö‡∏ó‡∏ó‡∏µ‡πà 2: ‡πÄ‡∏®‡∏©‡∏™‡πà‡∏ß‡∏ô', '‡∏ö‡∏ó‡∏ó‡∏µ‡πà 3: ‡∏ó‡∏®‡∏ô‡∏¥‡∏¢‡∏°', '‡∏ö‡∏ó‡∏ó‡∏µ‡πà 4: ‡πÄ‡∏£‡∏Ç‡∏≤‡∏Ñ‡∏ì‡∏¥‡∏ï', '‡∏ö‡∏ó‡∏ó‡∏µ‡πà 5: ‡∏™‡∏ñ‡∏¥‡∏ï‡∏¥‡πÄ‡∏ö‡∏∑‡πâ‡∏≠‡∏á‡∏ï‡πâ‡∏ô'],
      '‡∏†‡∏≤‡∏©‡∏≤‡πÑ‡∏ó‡∏¢': ['‡∏ö‡∏ó‡∏ó‡∏µ‡πà 1: ‡∏Å‡∏≤‡∏£‡∏≠‡πà‡∏≤‡∏ô‡πÅ‡∏•‡∏∞‡∏Å‡∏≤‡∏£‡πÄ‡∏Ç‡∏µ‡∏¢‡∏ô', '‡∏ö‡∏ó‡∏ó‡∏µ‡πà 2: ‡∏ß‡∏£‡∏£‡∏ì‡∏Ñ‡∏î‡∏µ‡πÑ‡∏ó‡∏¢', '‡∏ö‡∏ó‡∏ó‡∏µ‡πà 3: ‡∏´‡∏•‡∏±‡∏Å‡∏†‡∏≤‡∏©‡∏≤', '‡∏ö‡∏ó‡∏ó‡∏µ‡πà 4: ‡∏Å‡∏≤‡∏£‡πÄ‡∏Ç‡∏µ‡∏¢‡∏ô‡πÄ‡∏£‡∏µ‡∏¢‡∏á‡∏Ñ‡∏ß‡∏≤‡∏°', '‡∏ö‡∏ó‡∏ó‡∏µ‡πà 5: ‡∏ßÔøΩÔøΩÔøΩ‡∏£‡∏ì‡∏Å‡∏£‡∏£‡∏°'],
      '‡∏†‡∏≤‡∏©‡∏≤‡∏≠‡∏±‡∏á‡∏Å‡∏§‡∏©': ['Lesson 1: Greetings', 'Lesson 2: Present Tense', 'Lesson 3: Past Tense', 'Lesson 4: Reading Comprehension', 'Lesson 5: Writing Skills'],
      '‡∏™‡∏±‡∏á‡∏Ñ‡∏°': ['‡∏ö‡∏ó‡∏ó‡∏µ‡πà 1: ‡∏õ‡∏£‡∏∞‡∏ß‡∏±‡∏ï‡∏¥‡∏®‡∏≤‡∏™‡∏ï‡∏£‡πå‡πÑ‡∏ó‡∏¢', '‡∏ö‡∏ó‡∏ó‡∏µ‡πà 2: ‡∏†‡∏π‡∏°‡∏¥‡∏®‡∏≤‡∏™‡∏ï‡∏£‡πå', '‡∏ö‡∏ó‡∏ó‡∏µ‡πà 3: ‡πÄ‡∏®‡∏£‡∏©‡∏ê‡∏®‡∏≤‡∏™‡∏ï‡∏£‡πå', '‡∏ö‡∏ó‡∏ó‡∏µ‡πà 4: ‡∏™‡∏±‡∏á‡∏Ñ‡∏°‡πÅ‡∏•‡∏∞‡∏ß‡∏±‡∏í‡∏ô‡∏ò‡∏£‡∏£‡∏°', '‡∏ö‡∏ó‡∏ó‡∏µ‡πà 5: ‡∏Å‡∏≤‡∏£‡πÄ‡∏°‡∏∑‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡∏õ‡∏Å‡∏Ñ‡∏£‡∏≠‡∏á'],
      '‡∏ü‡∏¥‡∏™‡∏¥‡∏Å‡∏™‡πå': ['‡∏ö‡∏ó‡∏ó‡∏µ‡πà 1: ‡∏Å‡∏•‡∏®‡∏≤‡∏™‡∏ï‡∏£‡πå', '‡∏ö‡∏ó‡∏ó‡∏µ‡πà 2: ‡∏û‡∏•‡∏±‡∏á‡∏á‡∏≤‡∏ô‡πÅ‡∏•‡∏∞‡∏á‡∏≤‡∏ô', '‡∏ö‡∏ó‡∏ó‡∏µ‡πà 3: ‡∏Ñ‡∏•‡∏∑‡πà‡∏ô‡πÅ‡∏•‡∏∞‡πÄ‡∏™‡∏µ‡∏¢‡∏á', '‡∏ö‡∏ó‡∏ó‡∏µ‡πà 4: ÔøΩÔøΩ‡∏ü‡∏ü‡πâ‡∏≤', '‡∏ö‡∏ó‡∏ó‡∏µ‡πà 5: ‡πÅ‡∏™‡∏á‡πÅ‡∏•‡∏∞‡∏ó‡∏±‡∏®‡∏ô‡∏®‡∏≤‡∏™‡∏ï‡∏£‡πå'],
      '‡πÄ‡∏Ñ‡∏°‡∏µ': ['‡∏ö‡∏ó‡∏ó‡∏µ‡πà 1: ‡πÇ‡∏Ñ‡∏£‡∏á‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏≠‡∏∞‡∏ï‡∏≠‡∏°', '‡∏ö‡∏ó‡∏ó‡∏µ‡πà 2: ‡∏û‡∏±‡∏ô‡∏ò‡∏∞‡πÄ‡∏Ñ‡∏°‡∏µ', '‡∏ö‡∏ó‡∏ó‡∏µ‡πà 3: ‡∏™‡∏≤‡∏£‡∏•‡∏∞‡∏•‡∏≤‡∏¢', '‡∏ö‡∏ó‡∏ó‡∏µ‡πà 4: ‡∏õ‡∏è‡∏¥‡∏Å‡∏¥‡∏£‡∏¥‡∏¢‡∏≤‡πÄ‡∏Ñ‡∏°‡∏µ', '‡∏ö‡∏ó‡∏ó‡∏µ‡πà 5: ‡πÄ‡∏Ñ‡∏°‡∏µ‡∏≠‡∏¥‡∏ô‡∏ó‡∏£‡∏µ‡∏¢‡πå'],
      '‡∏ä‡∏µ‡∏ß‡∏ß‡∏¥‡∏ó‡∏¢‡∏≤': ['‡∏ö‡∏ó‡∏ó‡∏µ‡πà 1: ‡πÄ‡∏ã‡∏•‡∏•‡πå‡πÅ‡∏•‡∏∞‡∏Å‡∏≤‡∏£‡∏ó‡∏≥‡∏á‡∏≤‡∏ô', '‡∏ö‡∏ó‡∏ó‡∏µ‡πà 2: ‡∏û‡∏±‡∏ô‡∏ò‡∏∏‡∏®‡∏≤‡∏™‡∏ï‡∏£‡πå', '‡∏ö‡∏ó‡∏ó‡∏µ‡πà 3: ‡∏ß‡∏¥‡∏ß‡∏±‡∏í‡∏ô‡∏≤‡∏Å‡∏≤‡∏£', '‡∏ö‡∏ó‡∏ó‡∏µ‡πà 4: ‡∏ô‡∏¥‡πÄ‡∏ß‡∏®‡∏ß‡∏¥‡∏ó‡∏¢‡∏≤', '‡∏ö‡∏ó‡∏ó‡∏µ‡πà 5: ‡∏£‡∏∞‡∏ö‡∏ö‡πÉ‡∏ô‡∏£‡πà‡∏≤‡∏á‡∏Å‡∏≤‡∏¢']
    };
    
    function showToast(message, isError = false) {
      const toast = document.createElement('div');
      toast.className = `toast ${isError ? 'error' : ''}`;
      toast.textContent = message;
      document.body.appendChild(toast);
      setTimeout(() => toast.remove(), 3000);
    }
    
    function handleRegister(e) {
      e.preventDefault();
      const username = document.getElementById('reg-username').value.trim();
      const password = document.getElementById('reg-password').value;
      
      if (!username || !password) {
        showToast('‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏Å‡∏£‡∏≠‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÉ‡∏´‡πâ‡∏Ñ‡∏£‡∏ö‡∏ñ‡πâ‡∏ß‡∏ô', true);
        return;
      }
      
      if (password.length < 4) {
        showToast('‡∏£‡∏´‡∏±‡∏™‡∏ú‡πà‡∏≤‡∏ô‡∏ï‡πâ‡∏≠‡∏á‡∏°‡∏µ‡∏≠‡∏¢‡πà‡∏≤‡∏á‡∏ô‡πâ‡∏≠‡∏¢ 4 ‡∏´‡∏•‡∏±‡∏Å', true);
        return;
      }
      
      const existingUser = allUsers.find(u => u.username === username);
      if (existingUser) {
        showToast('‡∏ä‡∏∑‡πà‡∏≠‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ‡∏ô‡∏µ‡πâ‡∏°‡∏µ‡∏≠‡∏¢‡∏π‡πà‡πÅ‡∏•‡πâ‡∏ß', true);
        return;
      }
      
      const newUser = {
        id: `user_${Date.now()}_${Math.random()}`,
        username: username,
        password: password,
        created_at: new Date().toISOString()
      };
      
      allUsers.push(newUser);
      saveToLocalStorage('users', allUsers);
      
      showToast('‡∏™‡∏°‡∏±‡∏Ñ‡∏£‡∏™‡∏°‡∏≤‡∏ä‡∏¥‡∏Å‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à');
      document.getElementById('reg-username').value = '';
      document.getElementById('reg-password').value = '';
    }
    
    function handleLogin(e) {
      e.preventDefault();
      const username = document.getElementById('login-username').value.trim();
      const password = document.getElementById('login-password').value;
      
      if (!username || !password) {
        showToast('‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏Å‡∏£‡∏≠‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏πÔøΩÔøΩÔøΩ‡πÉ‡∏´‡πâ‡∏Ñ‡∏£‡∏ö‡∏ñ‡πâ‡∏ß‡∏ô', true);
        return;
      }
      
      const user = allUsers.find(u => u.username === username && u.password === password);
      if (user) {
        appState.currentUser = username;
        appState.currentView = 'grades';
        render();
        showToast('‡πÄ‡∏Ç‡πâ‡∏≤‡∏™‡∏π‡πà‡∏£‡∏∞‡∏ö‡∏ö‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à');
      } else {
        showToast('‡∏ä‡∏∑‡πà‡∏≠‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ‡∏´‡∏£‡∏∑‡∏≠‡∏£‡∏´‡∏±‡∏™‡∏ú‡πà‡∏≤‡∏ô‡πÑ‡∏°‡πà‡∏ñ‡∏π‡∏Å‡∏ï‡πâ‡∏≠‡∏á', true);
      }
    }
    
    function selectGrade(grade) {
      appState.selectedGrade = grade;
      appState.currentView = 'subjects';
      render();
    }
    
    function selectSubject(subject) {
      appState.selectedSubject = subject;
      appState.currentView = 'lessons';
      render();
    }
    
    function selectLesson(lesson) {
      appState.selectedLesson = lesson;
      appState.currentView = 'posts';
      appState.editingPostId = null;
      appState.imageUrls = [];
      render();
    }
    
    function handleImageInput(e) {
      const input = e.target;
      const files = Array.from(input.files);
      
      if (files.length > 5) {
        showToast('‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡πÅ‡∏ô‡∏ö‡∏£‡∏π‡∏õ‡∏†‡∏≤‡∏û‡πÑ‡∏î‡πâ‡∏™‡∏π‡∏á‡∏™‡∏∏‡∏î 5 ‡∏£‡∏π‡∏õ', true);
        input.value = '';
        return;
      }
      
      files.forEach(file => {
        if (appState.imageUrls.length >= 5) {
          showToast('‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡πÅ‡∏ô‡∏ö‡∏£‡∏π‡∏õ‡∏†‡∏≤‡∏û‡πÑ‡∏î‡πâ‡∏™‡∏π‡∏á‡∏™‡∏∏‡∏î 5 ‡∏£‡∏π‡∏õ', true);
          return;
        }
        
        const reader = new FileReader();
        reader.onload = (event) => {
          appState.imageUrls.push(event.target.result);
          renderImagePreviews();
        };
        reader.readAsDataURL(file);
      });
      
      input.value = '';
    }
    
    function removeImage(index) {
      appState.imageUrls.splice(index, 1);
      renderImagePreviews();
    }
    
    function renderImagePreviews() {
      const container = document.getElementById('image-previews');
      if (!container) return;
      
      container.innerHTML = '';
      appState.imageUrls.forEach((url, index) => {
        const preview = document.createElement('div');
        preview.className = 'image-preview';
        preview.innerHTML = `
          <img src="${url}" alt="Preview ${index + 1}">
          <div class="image-remove" onclick="removeImage(${index})">√ó</div>
        `;
        container.appendChild(preview);
      });
    }
    
    function handlePostSubmit(e) {
      e.preventDefault();
      const content = document.getElementById('post-content').value.trim();
      
      if (!content && appState.imageUrls.length === 0) {
        showToast('‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡πÄ‡∏û‡∏¥‡πà‡∏°‡πÄ‡∏ô‡∏∑‡πâ‡∏≠‡∏´‡∏≤‡∏´‡∏£‡∏∑‡∏≠‡∏£‡∏π‡∏õ‡∏†‡∏≤‡∏û', true);
        return;
      }
      
      if (appState.editingPostId) {
        const postIndex = allPosts.findIndex(p => p.post_id === appState.editingPostId);
        if (postIndex !== -1) {
          allPosts[postIndex].content = content;
          allPosts[postIndex].image_urls = appState.imageUrls;
          allPosts[postIndex].updated_at = new Date().toISOString();
          
          saveToLocalStorage('posts', allPosts);
          
          showToast('‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç‡πÇ‡∏û‡∏™‡∏ï‡πå‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à');
          appState.editingPostId = null;
          appState.imageUrls = [];
          document.getElementById('post-content').value = '';
          render();
        }
      } else {
        const newPost = {
          post_id: `post_${Date.now()}_${Math.random()}`,
          author: appState.currentUser,
          grade: appState.selectedGrade,
          subject: appState.selectedSubject,
          lesson: appState.selectedLesson,
          content: content,
          image_urls: appState.imageUrls,
          created_at: new Date().toISOString(),
          updated_at: null
        };
        
        allPosts.push(newPost);
        saveToLocalStorage('posts', allPosts);
        
        showToast('‡πÄ‡∏û‡∏¥‡πà‡∏°‡πÇ‡∏û‡∏™‡∏ï‡πå‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à');
        appState.imageUrls = [];
        document.getElementById('post-content').value = '';
        render();
      }
    }
    
    function editPost(postId) {
      const post = allPosts.find(p => p.post_id === postId);
      if (!post) return;
      
      appState.editingPostId = postId;
      appState.imageUrls = post.image_urls ? [...post.image_urls] : [];
      
      document.getElementById('post-content').value = post.content;
      renderImagePreviews();
      document.getElementById('post-content').focus();
      
      const cancelBtn = document.getElementById('cancel-edit-btn');
      if (cancelBtn) cancelBtn.style.display = 'inline-block';
    }
    
    function cancelEdit() {
      appState.editingPostId = null;
      appState.imageUrls = [];
      document.getElementById('post-content').value = '';
      renderImagePreviews();
      
      const cancelBtn = document.getElementById('cancel-edit-btn');
      if (cancelBtn) cancelBtn.style.display = 'none';
    }
    
    function deletePost(postId) {
      const deleteBtn = event.target;
      const originalText = deleteBtn.textContent;
      
      if (deleteBtn.dataset.confirming === 'true') {
        const postIndex = allPosts.findIndex(p => p.post_id === postId);
        if (postIndex !== -1) {
          allPosts.splice(postIndex, 1);
          saveToLocalStorage('posts', allPosts);
          showToast('‡∏•‡∏ö‡πÇ‡∏û‡∏™‡∏ï‡πå‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à');
          render();
        }
      } else {
        deleteBtn.textContent = '‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô‡∏Å‡∏≤‡∏£‡∏•‡∏ö?';
        deleteBtn.dataset.confirming = 'true';
        setTimeout(() => {
          deleteBtn.textContent = originalText;
          deleteBtn.dataset.confirming = 'false';
        }, 3000);
      }
    }
    
    function logout() {
      appState = {
        currentView: 'login',
        currentUser: null,
        selectedGrade: null,
        selectedSubject: null,
        selectedLesson: null,
        editingPostId: null,
        imageUrls: []
      };
      render();
      showToast('‡∏≠‡∏≠‡∏Å‡∏à‡∏≤‡∏Å‡∏£‡∏∞‡∏ö‡∏ö‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à');
    }
    
    function backToGrades() {
      appState.selectedGrade = null;
      appState.selectedSubject = null;
      appState.selectedLesson = null;
      appState.currentView = 'grades';
      render();
    }
    
    function backToSubjects() {
      appState.selectedSubject = null;
      appState.selectedLesson = null;
      appState.currentView = 'subjects';
      render();
    }
    
    function backToLessons() {
      appState.selectedLesson = null;
      appState.currentView = 'lessons';
      render();
    }
    
    function togglePassword(inputId, eyeId) {
      const input = document.getElementById(inputId);
      const eye = document.getElementById(eyeId);
      
      if (input.type === 'password') {
        input.type = 'text';
        eye.textContent = 'üôà';
      } else {
        input.type = 'password';
        eye.textContent = 'üëÅÔ∏è';
      }
    }
    
    function render() {
      const config = window.elementSdk ? window.elementSdk.config : defaultConfig;
      const app = document.getElementById('app');
      
      const customFont = config.font_family || defaultConfig.font_family;
      const baseSize = config.font_size || defaultConfig.font_size;
      const baseFontStack = 'Arial, sans-serif';
      
      document.body.style.fontFamily = `${customFont}, ${baseFontStack}`;
      document.body.style.fontSize = `${baseSize}px`;
      
      if (appState.currentView === 'login') {
        app.innerHTML = `
          <div class="w-full h-full flex items-center justify-center" style="background-color: ${config.secondary_color || defaultConfig.secondary_color};">
            <div class="w-full max-w-md p-8 rounded-lg shadow-lg" style="background-color: ${config.card_color || defaultConfig.card_color};">
              <h1 class="text-center font-bold mb-2" style="font-size: ${baseSize * 2}px; color: ${config.text_color || defaultConfig.text_color};">${config.site_title || defaultConfig.site_title}</h1>
              <p class="text-center mb-8" style="font-size: ${baseSize * 0.9}px; color: ${config.text_color || defaultConfig.text_color};">${config.welcome_message || defaultConfig.welcome_message}</p>
              
              <div class="mb-8">
                <h2 class="font-bold mb-4" style="font-size: ${baseSize * 1.3}px; color: ${config.text_color || defaultConfig.text_color};">‡πÄ‡∏Ç‡πâ‡∏≤‡∏™‡∏π‡πà‡∏£‡∏∞‡∏ö‡∏ö</h2>
                <form onsubmit="handleLogin(event)">
                  <div class="mb-4">
                    <label for="login-username" class="block mb-2" style="font-size: ${baseSize * 0.9}px; color: ${config.text_color || defaultConfig.text_color};">‡∏ä‡∏∑‡πà‡∏≠‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ</label>
                    <input type="text" id="login-username" class="w-full px-4 py-2 border rounded-lg" style="font-size: ${baseSize}px; border-color: ${config.secondary_color || defaultConfig.secondary_color};" required>
                  </div>
                  <div class="mb-4">
                    <label for="login-password" class="block mb-2" style="font-size: ${baseSize * 0.9}px; color: ${config.text_color || defaultConfig.text_color};">‡∏£‡∏´‡∏±‡∏™‡∏ú‡πà‡∏≤‡∏ô</label>
                    <div style="position: relative;">
                      <input type="password" id="login-password" class="w-full px-4 py-2 border rounded-lg" style="font-size: ${baseSize}px; border-color: ${config.secondary_color || defaultConfig.secondary_color}; padding-right: 45px;" required minlength="4">
                      <button type="button" onclick="togglePassword('login-password', 'login-eye')" style="position: absolute; right: 12px; top: 50%; transform: translateY(-50%); background: none; border: none; cursor: pointer; font-size: ${baseSize * 1.2}px;">
                        <span id="login-eye">üëÅÔ∏è</span>
                      </button>
                    </div>
                  </div>
                  <button type="submit" class="w-full px-4 py-2 rounded-lg text-white font-bold" style="background-color: ${config.primary_color || defaultConfig.primary_color}; font-size: ${baseSize}px;">‡πÄ‡∏Ç‡πâ‡∏≤‡∏™‡∏π‡πà‡∏£‡∏∞‡∏ö‡∏ö</button>
                </form>
              </div>
              
              <div class="pt-8 border-t" style="border-color: ${config.secondary_color || defaultConfig.secondary_color};">
                <h2 class="font-bold mb-4" style="font-size: ${baseSize * 1.3}px; color: ${config.text_color || defaultConfig.text_color};">‡∏™‡∏°‡∏±‡∏Ñ‡∏£‡∏™‡∏°‡∏≤‡∏ä‡∏¥‡∏Å</h2>
                <form onsubmit="handleRegister(event)">
                  <div class="mb-4">
                    <label for="reg-username" class="block mb-2" style="font-size: ${baseSize * 0.9}px; color: ${config.text_color || defaultConfig.text_color};">‡∏ä‡∏∑‡πà‡∏≠‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ</label>
                    <input type="text" id="reg-username" class="w-full px-4 py-2 border rounded-lg" style="font-size: ${baseSize}px; border-color: ${config.secondary_color || defaultConfig.secondary_color};" required>
                  </div>
                  <div class="mb-4">
                    <label for="reg-password" class="block mb-2" style="font-size: ${baseSize * 0.9}px; color: ${config.text_color || defaultConfig.text_color};">‡∏£‡∏´‡∏±‡∏™‡∏ú‡πà‡∏≤‡∏ô (‡∏≠‡∏¢‡πà‡∏≤‡∏á‡∏ô‡πâ‡∏≠‡∏¢ 4 ‡∏´‡∏•‡∏±‡∏Å)</label>
                    <div style="position: relative;">
                      <input type="password" id="reg-password" class="w-full px-4 py-2 border rounded-lg" style="font-size: ${baseSize}px; border-color: ${config.secondary_color || defaultConfig.secondary_color}; padding-right: 45px;" required minlength="4">
                      <button type="button" onclick="togglePassword('reg-password', 'reg-eye')" style="position: absolute; right: 12px; top: 50%; transform: translateY(-50%); background: none; border: none; cursor: pointer; font-size: ${baseSize * 1.2}px;">
                        <span id="reg-eye">üëÅÔ∏è</span>
                      </button>
                    </div>
                  </div>
                  <button type="submit" class="w-full px-4 py-2 rounded-lg text-white font-bold" style="background-color: ${config.accent_color || defaultConfig.accent_color}; font-size: ${baseSize}px;">‡∏™‡∏°‡∏±‡∏Ñ‡∏£‡∏™‡∏°‡∏≤‡∏ä‡∏¥‡∏Å</button>
                </form>
              </div>
            </div>
          </div>
        `;
      } else if (appState.currentView === 'grades') {
        app.innerHTML = `
          <div class="w-full h-full overflow-auto" style="background-color: ${config.secondary_color || defaultConfig.secondary_color};">
            <div class="max-w-6xl mx-auto p-8">
              <div class="flex justify-between items-center mb-8">
                <h1 class="font-bold" style="font-size: ${baseSize * 2}px; color: ${config.text_color || defaultConfig.text_color};">‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏£‡∏∞‡∏î‡∏±‡∏ö‡∏ä‡∏±‡πâ‡∏ô</h1>
                <button onclick="logout()" class="px-6 py-2 rounded-lg text-white font-bold" style="background-color: #ef4444; font-size: ${baseSize * 0.9}px;">‡∏≠‡∏≠‡∏Å‡∏à‡∏≤‡∏Å‡∏£‡∏∞‡∏ö‡∏ö</button>
              </div>
              <p class="mb-8" style="font-size: ${baseSize}px; color: ${config.text_color || defaultConfig.text_color};">‡∏™‡∏ß‡∏±‡∏™‡∏î‡∏µ ${appState.currentUser}!</p>
              
              <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
                ${Object.keys(gradeSubjects).map(grade => `
                  <div class="lesson-card p-6 rounded-lg shadow-md cursor-pointer" style="background-color: ${config.card_color || defaultConfig.card_color}; border-left: 4px solid ${config.primary_color || defaultConfig.primary_color};" onclick="selectGrade('${grade}')">
                    <h3 class="font-bold text-center" style="font-size: ${baseSize * 1.5}px; color: ${config.primary_color || defaultConfig.primary_color};">${grade}</h3>
                  </div>
                `).join('')}
              </div>
            </div>
          </div>
        `;
      } else if (appState.currentView === 'subjects') {
        app.innerHTML = `
          <div class="w-full h-full overflow-auto" style="background-color: ${config.secondary_color || defaultConfig.secondary_color};">
            <div class="max-w-6xl mx-auto p-8">
              <div class="flex justify-between items-center mb-8">
                <div>
                  <button onclick="backToGrades()" class="px-4 py-2 rounded-lg mb-4" style="background-color: ${config.card_color || defaultConfig.card_color}; font-size: ${baseSize * 0.9}px; color: ${config.text_color || defaultConfig.text_color};">‚Üê ‡∏Å‡∏•‡∏±‡∏ö</button>
                  <h1 class="font-bold" style="font-size: ${baseSize * 2}px; color: ${config.text_color || defaultConfig.text_color};">‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏ß‡∏¥‡∏ä‡∏≤ (${appState.selectedGrade})</h1>
                </div>
                <button onclick="logout()" class="px-6 py-2 rounded-lg text-white font-bold" style="background-color: #ef4444; font-size: ${baseSize * 0.9}px;">‡∏≠‡∏≠‡∏Å‡∏à‡∏≤‡∏Å‡∏£‡∏∞‡∏ö‡∏ö</button>
              </div>
              
              <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
                ${gradeSubjects[appState.selectedGrade].map(subject => `
                  <div class="lesson-card p-6 rounded-lg shadow-md cursor-pointer" style="background-color: ${config.card_color || defaultConfig.card_color}; border-left: 4px solid ${config.accent_color || defaultConfig.accent_color};" onclick="selectSubject('${subject}')">
                    <h3 class="font-bold text-center" style="font-size: ${baseSize * 1.3}px; color: ${config.text_color || defaultConfig.text_color};">${subject}</h3>
                  </div>
                `).join('')}
              </div>
            </div>
          </div>
        `;
      } else if (appState.currentView === 'lessons') {
        app.innerHTML = `
          <div class="w-full h-full overflow-auto" style="background-color: ${config.secondary_color || defaultConfig.secondary_color};">
            <div class="max-w-6xl mx-auto p-8">
              <div class="flex justify-between items-center mb-8">
                <div>
                  <button onclick="backToSubjects()" class="px-4 py-2 rounded-lg mb-4" style="background-color: ${config.card_color || defaultConfig.card_color}; font-size: ${baseSize * 0.9}px; color: ${config.text_color || defaultConfig.text_color};">‚Üê ‡∏Å‡∏•‡∏±‡∏ö</button>
                  <h1 class="font-bold" style="font-size: ${baseSize * 2}px; color: ${config.text_color || defaultConfig.text_color};">‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏ö‡∏ó‡πÄ‡∏£‡∏µ‡∏¢‡∏ô</h1>
                  <p style="font-size: ${baseSize}px; color: ${config.text_color || defaultConfig.text_color};">${appState.selectedGrade} - ${appState.selectedSubject}</p>
                </div>
                <button onclick="logout()" class="px-6 py-2 rounded-lg text-white font-bold" style="background-color: #ef4444; font-size: ${baseSize * 0.9}px;">‡∏≠‡∏≠‡∏Å‡∏à‡∏≤‡∏Å‡∏£‡∏∞‡∏ö‡∏ö</button>
              </div>
              
              <div class="grid grid-cols-1 gap-4">
                ${subjectLessons[appState.selectedSubject].map(lesson => `
                  <div class="lesson-card p-6 rounded-lg shadow-md cursor-pointer" style="background-color: ${config.card_color || defaultConfig.card_color}; border-left: 4px solid ${config.primary_color || defaultConfig.primary_color};" onclick="selectLesson('${lesson}')">
                    <h3 class="font-bold" style="font-size: ${baseSize * 1.2}px; color: ${config.text_color || defaultConfig.text_color};">${lesson}</h3>
                  </div>
                `).join('')}
              </div>
            </div>
          </div>
        `;
      } else if (appState.currentView === 'posts') {
        const lessonPosts = allPosts.filter(p => 
          p.grade === appState.selectedGrade && 
          p.subject === appState.selectedSubject && 
          p.lesson === appState.selectedLesson
        ).sort((a, b) => new Date(b.created_at) - new Date(a.created_at));
        
        app.innerHTML = `
          <div class="w-full h-full overflow-auto" style="background-color: ${config.secondary_color || defaultConfig.secondary_color};">
            <div class="max-w-4xl mx-auto p-8">
              <div class="flex justify-between items-center mb-8">
                <div>
                  <button onclick="backToLessons()" class="px-4 py-2 rounded-lg mb-4" style="background-color: ${config.card_color || defaultConfig.card_color}; font-size: ${baseSize * 0.9}px; color: ${config.text_color || defaultConfig.text_color};">‚Üê ‡∏Å‡∏•‡∏±‡∏ö</button>
                  <h1 class="font-bold" style="font-size: ${baseSize * 1.8}px; color: ${config.text_color || defaultConfig.text_color};">${appState.selectedLesson}</h1>
                  <p style="font-size: ${baseSize * 0.85}px; color: ${config.text_color || defaultConfig.text_color};">${appState.selectedGrade} - ${appState.selectedSubject}</p>
                </div>
                <button onclick="logout()" class="px-6 py-2 rounded-lg text-white font-bold" style="background-color: #ef4444; font-size: ${baseSize * 0.9}px;">‡∏≠‡∏≠‡∏Å‡∏à‡∏≤‡∏Å‡∏£‡∏∞‡∏ö‡∏ö</button>
              </div>
              
              <div class="p-6 rounded-lg shadow-md mb-8" style="background-color: ${config.card_color || defaultConfig.card_color};">
                <h2 class="font-bold mb-4" style="font-size: ${baseSize * 1.3}px; color: ${config.text_color || defaultConfig.text_color};">${appState.editingPostId ? '‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç‡πÇ‡∏û‡∏™‡∏ï‡πå' : '‡πÄ‡∏û‡∏¥‡πà‡∏°‡πÄ‡∏ô‡∏∑‡πâ‡∏≠‡∏´‡∏≤'}</h2>
                <form onsubmit="handlePostSubmit(event)">
                  <div class="mb-4">
                    <label for="post-content" class="block mb-2" style="font-size: ${baseSize * 0.9}px; color: ${config.text_color || defaultConfig.text_color};">‡πÄ‡∏ô‡∏∑‡πâ‡∏≠‡∏´‡∏≤</label>
                    <textarea id="post-content" class="w-full px-4 py-2 border rounded-lg" rows="4" style="font-size: ${baseSize}px; border-color: ${config.secondary_color || defaultConfig.secondary_color};" placeholder="‡πÄ‡∏Ç‡∏µ‡∏¢‡∏ô‡πÄ‡∏ô‡∏∑‡πâ‡∏≠‡∏´‡∏≤‡∏ó‡∏µ‡πà‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡πÅ‡∏ä‡∏£‡πå..."></textarea>
                  </div>
                  
                  <div class="mb-4">
                    <label class="block mb-2" style="font-size: ${baseSize * 0.9}px; color: ${config.text_color || defaultConfig.text_color};">‡πÅ‡∏ô‡∏ö‡∏£‡∏π‡∏õ‡∏†‡∏≤‡∏û (‡∏™‡∏π‡∏á‡∏™‡∏∏‡∏î 5 ‡∏£‡∏π‡∏õ)</label>
                    <input type="file" accept="image/*" multiple onchange="handleImageInput(event)" class="w-full px-4 py-2 border rounded-lg" style="font-size: ${baseSize * 0.85}px; border-color: ${config.secondary_color || defaultConfig.secondary_color};">
                    <div id="image-previews" class="mt-4"></div>
                  </div>
                  
                  <div class="flex gap-4">
                    <button type="submit" class="px-6 py-2 rounded-lg text-white font-bold" style="background-color: ${config.primary_color || defaultConfig.primary_color}; font-size: ${baseSize}px;">${appState.editingPostId ? '‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å' : '‡πÄ‡∏û‡∏¥‡πà‡∏°‡πÇ‡∏û‡∏™‡∏ï‡πå'}</button>
                    <button type="button" id="cancel-edit-btn" onclick="cancelEdit()" class="px-6 py-2 rounded-lg font-bold" style="background-color: ${config.secondary_color || defaultConfig.secondary_color}; color: ${config.text_color || defaultConfig.text_color}; font-size: ${baseSize}px; display: none;">‡∏¢‡∏Å‡πÄ‡∏•‡∏¥‡∏Å</button>
                  </div>
                </form>
              </div>
              
              <div>
                <h2 class="font-bold mb-4" style="font-size: ${baseSize * 1.3}px; color: ${config.text_color || defaultConfig.text_color};">‡πÇ‡∏û‡∏™‡∏ï‡πå‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î (${lessonPosts.length})</h2>
                ${lessonPosts.length === 0 ? 
                  `<p class="text-center py-8" style="font-size: ${baseSize}px; color: ${config.text_color || defaultConfig.text_color};">‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏°‡∏µ‡πÇ‡∏û‡∏™‡∏ï‡πåÔøΩÔøΩÔøΩ‡∏ô‡∏ö‡∏ó‡πÄ‡∏£‡∏µ‡∏¢‡∏ô‡∏ô‡∏µ‡πâ</p>` :
                  lessonPosts.map(post => {
                    const images = post.image_urls || [];
                    const isAuthor = post.author === appState.currentUser;
                    const createdDate = new Date(post.created_at).toLocaleString('th-TH');
                    const updatedDate = post.updated_at ? new Date(post.updated_at).toLocaleString('th-TH') : null;
                    
                    return `
                      <div class="post-card p-6 rounded-lg shadow-md mb-4" style="background-color: ${config.card_color || defaultConfig.card_color}; border-color: ${config.accent_color || defaultConfig.accent_color};">
                        <div class="flex justify-between items-start mb-4">
                          <div>
                            <p class="font-bold" style="font-size: ${baseSize * 1.1}px; color: ${config.text_color || defaultConfig.text_color};">${post.author}</p>
                            <p style="font-size: ${baseSize * 0.75}px; color: ${config.text_color || defaultConfig.text_color};">${createdDate}${updatedDate ? ` (‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç: ${updatedDate})` : ''}</p>
                          </div>
                          ${isAuthor ? `
                            <div class="flex gap-2">
                              <button onclick="editPost('${post.post_id}')" class="px-4 py-1 rounded text-white" style="background-color: ${config.primary_color || defaultConfig.primary_color}; font-size: ${baseSize * 0.85}px;">‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç</button>
                              <button onclick="deletePost('${post.post_id}')" data-confirming="false" class="px-4 py-1 rounded text-white" style="background-color: #ef4444; font-size: ${baseSize * 0.85}px;">‡∏•‡∏ö</button>
                            </div>
                          ` : ''}
                        </div>
                        
                        ${post.content ? `<p class="mb-4 whitespace-pre-wrap" style="font-size: ${baseSize}px; color: ${config.text_color || defaultConfig.text_color};">${post.content}</p>` : ''}
                        
                        ${images.length > 0 ? `
                          <div class="grid grid-cols-2 md:grid-cols-3 gap-4">
                            ${images.map(url => `
                              <img src="${url}" alt="‡∏£‡∏π‡∏õ‡∏†‡∏≤‡∏û‡πÇ‡∏û‡∏™‡∏ï‡πå" class="w-full h-48 object-cover rounded-lg" onerror="this.src=''; this.alt='‡∏£‡∏π‡∏õ‡∏†‡∏≤‡∏û‡πÇ‡∏´‡∏•‡∏î‡πÑ‡∏°‡πà‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à'; this.style.display='none';">
                            `).join('')}
                          </div>
                        ` : ''}
                      </div>
                    `;
                  }).join('')
                }
              </div>
            </div>
          </div>
        `;
        
        renderImagePreviews();
        
        if (appState.editingPostId) {
          const cancelBtn = document.getElementById('cancel-edit-btn');
          if (cancelBtn) cancelBtn.style.display = 'inline-block';
        }
      }
    }
    
    async function onConfigChange(config) {
      const customFont = config.font_family || defaultConfig.font_family;
      const baseSize = config.font_size || defaultConfig.font_size;
      const baseFontStack = 'Arial, sans-serif';
      
      document.body.style.fontFamily = `${customFont}, ${baseFontStack}`;
      document.body.style.fontSize = `${baseSize}px`;
      
      render();
    }
    
    function initApp() {
      if (window.elementSdk) {
        window.elementSdk.init({
          defaultConfig,
          onConfigChange,
          mapToCapabilities: (config) => ({
            recolorables: [
              {
                get: () => config.primary_color || defaultConfig.primary_color,
                set: (value) => {
                  config.primary_color = value;
                  window.elementSdk.setConfig({ primary_color: value });
                }
              },
              {
                get: () => config.secondary_color || defaultConfig.secondary_color,
                set: (value) => {
                  config.secondary_color = value;
                  window.elementSdk.setConfig({ secondary_color: value });
                }
              },
              {
                get: () => config.text_color || defaultConfig.text_color,
                set: (value) => {
                  config.text_color = value;
                  window.elementSdk.setConfig({ text_color: value });
                }
              },
              {
                get: () => config.card_color || defaultConfig.card_color,
                set: (value) => {
                  config.card_color = value;
                  window.elementSdk.setConfig({ card_color: value });
                }
              },
              {
                get: () => config.accent_color || defaultConfig.accent_color,
                set: (value) => {
                  config.accent_color = value;
                  window.elementSdk.setConfig({ accent_color: value });
                }
              }
            ],
            borderables: [],
            fontEditable: {
              get: () => config.font_family || defaultConfig.font_family,
              set: (value) => {
                config.font_family = value;
                window.elementSdk.setConfig({ font_family: value });
              }
            },
            fontSizeable: {
              get: () => config.font_size || defaultConfig.font_size,
              set: (value) => {
                config.font_size = value;
                window.elementSdk.setConfig({ font_size: value });
              }
            }
          }),
          mapToEditPanelValues: (config) => new Map([
            ['site_title', config.site_title || defaultConfig.site_title],
            ['welcome_message', config.welcome_message || defaultConfig.welcome_message]
          ])
        });
      }
      
      render();
    }
    
    window.handleRegister = handleRegister;
    window.handleLogin = handleLogin;
    window.selectGrade = selectGrade;
    window.selectSubject = selectSubject;
    window.selectLesson = selectLesson;
    window.handleImageInput = handleImageInput;
    window.removeImage = removeImage;
    window.handlePostSubmit = handlePostSubmit;
    window.editPost = editPost;
    window.cancelEdit = cancelEdit;
    window.deletePost = deletePost;
    window.logout = logout;
    window.backToGrades = backToGrades;
    window.backToSubjects = backToSubjects;
    window.backToLessons = backToLessons;
    window.togglePassword = togglePassword;
    
    initApp();
  </script>
 <script>(function(){function c(){var b=a.contentDocument||a.contentWindow.document;if(b){var d=b.createElement('script');d.innerHTML="window.__CF$cv$params={r:'9aef9a72e069ce6d',t:'MTc2NTkwMzAyNS4wMDAwMDA='};var a=document.createElement('script');a.nonce='';a.src='/cdn-cgi/challenge-platform/scripts/jsd/main.js';document.getElementsByTagName('head')[0].appendChild(a);";b.getElementsByTagName('head')[0].appendChild(d)}}if(document.body){var a=document.createElement('iframe');a.height=1;a.width=1;a.style.position='absolute';a.style.top=0;a.style.left=0;a.style.border='none';a.style.visibility='hidden';document.body.appendChild(a);if('loading'!==document.readyState)c();else if(window.addEventListener)document.addEventListener('DOMContentLoaded',c);else{var e=document.onreadystatechange||function(){};document.onreadystatechange=function(b){e(b);'loading'!==document.readyState&&(document.onreadystatechange=e,c())}}}})();</script></body>
</html>
